(()=>{"use strict";const e=document.querySelector(".profile__edit-btn"),t=document.querySelector("#edit-profile-popup"),r=document.querySelector(".profile__name"),o=document.querySelector(".profile__text"),n=document.querySelector(".popup__form-input_field-name"),c=document.querySelector(".popup__form-input_field-profession"),a=document.querySelector(".popup-edit__close-btn"),l=document.querySelector("#image-preview"),s=document.querySelector(".cards__list"),d=document.querySelector(".popup__form_edit-profile"),i=document.querySelector(".popup__form_add-place"),u=document.querySelector(".popup__form-input_place-name"),p=document.querySelector(".popup__form-input_place-link"),_=document.querySelector(".profile__add-btn"),m=document.querySelector("#new-place-popup"),v=document.querySelector(".popup-add__close-btn"),h=document.querySelector(".popup-pic__close-btn"),f=document.querySelector("#add-avatar"),y=document.querySelector(".profile__avatar-btn"),S=f.querySelector(".popup-avatar__close-btn"),b=f.querySelector(".popup-submit-avatar"),q=f.querySelector(".popup__form-input_avatar-link"),E=document.querySelector(".profile__avatar"),L=f.querySelector(".popup__form-avatar"),k=document.querySelector("#image-preview .popup__image"),g=document.querySelector("#image-preview .popup__title-image"),C=(e,t,r)=>{$(e)?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)},$=e=>e.some((e=>!e.validity.valid));function x(e){e.classList.add("popup_open"),document.addEventListener("keydown",T),e.addEventListener("mousedown",A)}function w(e){e.classList.remove("popup_open"),document.removeEventListener("keydown",T),e.removeEventListener("mousedown",A)}function T(e){if("Escape"===e.key){const e=document.querySelector(".popup_open");e&&w(e)}}function A(e){e.target.classList.contains("popup_open")&&w(e.target)}const D={url:"https://nomoreparties.co/v1/plus-cohort-10/",headers:{authorization:"364cb9b7-1bf6-49d7-b364-1aee592e0a41","Content-Type":"application/json"}};function N(e){return e.ok?e.json():Promise.reject(`Ошибка ${e.status} - ${e.statusText}`)}function P(e,t,r,o,n,c){const a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),s=a.querySelector(".card__pic");a.querySelector(".card__title").textContent=e,s.src=t,s.alt=e;const d=a.querySelector(".card__like-btn"),i=a.querySelector(".card__like-acc");return i.textContent=`${r.length}`,o!==c&&a.querySelector(".card__trash-btn").classList.add("card__trash-btn_disabled"),r.some((e=>e._id===c))&&d.classList.add("card__like_active-btn"),d.addEventListener("click",(e=>{var t;e.target.classList.contains("card__like_active-btn")?(t=n,fetch(`${D.url}/cards/likes/${t}`,{method:"DELETE",headers:D.headers}).then(N)).then((e=>{d.classList.remove("card__like_active-btn"),i.textContent=`${e.likes.length}`})).catch((e=>{console.log(e)})):function(e){return fetch(`${D.url}/cards/likes/${e}`,{method:"PUT",headers:D.headers}).then(N)}(n).then((e=>{d.classList.add("card__like_active-btn"),i.textContent=`${e.likes.length}`})).catch((e=>{console.log(e)}))})),a.querySelector(".card__trash-btn").addEventListener("click",(e=>{var t;(t=n,fetch(`${D.url}/cards/${t}`,{method:"DELETE",headers:D.headers}).then(N)).then((()=>{e.target.closest(".card").remove()})).catch((e=>{console.log(e)}))})),s.addEventListener("click",(r=>{k.src=t,k.alt=e,g.textContent=e,x(l)})),a}function B(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function O(e){e.classList.add("popup-btn_disabled"),e.disabled=!0}const j=document.querySelector("#submit-edit");let J=null;var W;y.addEventListener("click",(()=>{x(f)})),S.addEventListener("click",(()=>{w(f)})),d.addEventListener("submit",(function(e){var a,l;e.preventDefault(),B(!0,j),(a=n.value,l=c.value,fetch(`${D.url}/users/me`,{method:"PATCH",headers:D.headers,body:JSON.stringify({name:a,about:l})}).then(N)).then((()=>{r.textContent=`${n.value}`,o.textContent=`${c.value}`,e.target.reset(),w(t)})).catch((e=>{console.log(e)})).finally((()=>{B(!1,j)}))})),h.addEventListener("click",(()=>{w(l)})),_.addEventListener("click",(()=>{x(m)})),i.addEventListener("submit",(function(e){var t,r;e.preventDefault(),B(!0,H),(t=u.value,r=p.value,fetch(`${D.url}/cards`,{method:"POST",headers:D.headers,body:JSON.stringify({name:t,link:r})}).then(N)).then((e=>{const t=P(e.name,e.link,e.likes,e.owner._id,e._id,J._id);s.prepend(t)})).then((()=>{e.target.reset(),O(H),w(m)})).catch((e=>{console.log(e)})).finally((()=>{B(!1,H)}))})),L.addEventListener("submit",(function(e){var t;e.preventDefault(),B(!0,b),(t=q.value,fetch(`${D.url}/users/me/avatar`,{method:"PATCH",headers:D.headers,body:JSON.stringify({avatar:t})}).then(N)).then((()=>{E.src=q.value,w(f),O(b),e.target.reset()})).catch((e=>{console.log(e)})).finally((()=>{B(!1,b)}))})),e.addEventListener("click",(()=>{x(t),n.value=r.textContent,c.value=o.textContent})),a.addEventListener("click",(()=>{w(t)})),v.addEventListener("click",(()=>{w(m)})),h.addEventListener("click",(()=>{w(l)})),W={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup-btn",inactiveButtonClass:"popup-btn_disabled",inputErrorClass:"popup__form-input_error",errorWrapperSelector:".popup__error-message"},Array.from(document.querySelectorAll(W.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);C(r,o,t),r.forEach((e=>{e.addEventListener("input",(function(){((e,t,r)=>{t.validity.valid?((e,t,r)=>{const o=t.parentNode.querySelector(r.errorWrapperSelector);t.classList.remove(r.inputElementError),o.classList.remove(r.errorElementClass),o.textContent=""})(0,t,r):((e,t,r,o)=>{const n=t.parentNode.querySelector(o.errorWrapperSelector);t.classList.add(o.inputElementError),n.classList.add(o.errorElementClass),n.textContent=r})(0,t,t.validationMessage,r)})(0,e,t),C(r,o,t)}))}))})(e,W)}));const H=document.querySelector("#submit-add");Promise.all([fetch(`${D.url}/users/me`,{headers:D.headers}).then(N),fetch(`${D.url}/cards`,{headers:D.headers}).then(N)]).then((([e,t])=>{J=e,r.textContent=J.name,o.textContent=J.about,E.src=J.avatar,t.forEach((e=>{const t=P(e.name,e.link,e.likes,e.owner._id,e._id,J._id);s.append(t)}))})).catch((e=>{console.log(e)}))})();