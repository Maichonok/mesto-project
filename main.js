(()=>{"use strict";const e=document.querySelector(".profile__edit-btn"),t=document.querySelector("#edit-profile-popup"),r=document.querySelector(".profile__name"),o=document.querySelector(".profile__text"),n=document.querySelector(".popup__form-input_field-name"),c=document.querySelector(".popup__form-input_field-profession"),a=document.querySelector(".popup-edit__close-btn"),l=document.querySelector("#image-preview");n.value=r.textContent,c.value=o.textContent;const s=document.querySelector(".cards__list"),i=document.querySelector(".popup__form_edit-profile"),d=document.querySelector(".popup__form_add-place"),u=document.querySelector(".popup__form-input_place-name"),p=document.querySelector(".popup__form-input_place-link"),_=document.querySelector(".profile__add-btn"),m=document.querySelector("#new-place-popup"),v=document.querySelector(".popup-add__close-btn"),h=document.querySelector(".popup-pic__close-btn"),y=document.querySelector("#add-avatar"),f=document.querySelector(".profile__avatar-btn"),S=y.querySelector(".popup-avatar__close-btn"),q=y.querySelector(".popup-submit-avatar"),b=y.querySelector(".popup__form-input_avatar-link"),E=document.querySelector(".profile__avatar"),L=y.querySelector(".popup__form-avatar"),k=(e,t,r)=>{g(e)?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)},g=e=>e.some((e=>!e.validity.valid));function C(e){e.classList.add("popup_open"),document.addEventListener("keydown",x),e.addEventListener("mousedown",w)}function $(e){e.classList.remove("popup_open"),document.removeEventListener("keydown",x),e.removeEventListener("mousedown",w)}function x(e){if("Escape"===e.key){const e=document.querySelector(".popup_open");e&&$(e)}}function w(e){e.target.classList.contains("popup_open")&&$(e.target)}const P={url:"https://nomoreparties.co/v1/plus-cohort-10/",headers:{authorization:"364cb9b7-1bf6-49d7-b364-1aee592e0a41","Content-Type":"application/json"}};function T(e){return e.ok?e.json():Promise.reject(`Ошибка ${e.status} - ${e.statusText}`)}function A(){return fetch(`${P.url}/users/me`,{headers:P.headers}).then(T)}function D(e,t,r,o,n,c){const a=document.querySelector("#image-preview .popup__image"),s=document.querySelector("#image-preview .popup__title-image"),i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),d=i.querySelector(".card__pic");i.querySelector(".card__title").textContent=e,d.src=t,d.alt=e;const u=i.querySelector(".card__like-acc");return u.textContent=`${r.length}`,o!==c&&i.querySelector(".card__trash-btn").classList.add("card__trash-btn_disabled"),r.some((e=>e._id===c))&&i.querySelector(".card__like-btn").classList.add("card__like_active-btn"),i.querySelector(".card__like-btn").addEventListener("click",(e=>{var t;e.target.classList.contains("card__like_active-btn")?(t=n,fetch(`${P.url}/cards/likes/${t}`,{method:"DELETE",headers:P.headers}).then(T)).then((e=>{i.querySelector(".card__like-btn").classList.remove("card__like_active-btn"),u.textContent=`${e.likes.length}`})).catch((e=>{console.log(e)})):function(e){return fetch(`${P.url}/cards/likes/${e}`,{method:"PUT",headers:P.headers}).then(T)}(n).then((e=>{i.querySelector(".card__like-btn").classList.add("card__like_active-btn"),u.textContent=`${e.likes.length}`})).catch((e=>{console.log(e)}))})),i.querySelector(".card__trash-btn").addEventListener("click",(e=>{var t;(t=n,fetch(`${P.url}/cards/${t}`,{method:"DELETE",headers:P.headers}).then(T)).then((()=>{e.target.closest(".card").remove()}))})),i.querySelector(".card__pic").addEventListener("click",(e=>{const t=i.querySelector(".card__pic").src,r=i.querySelector(".card__title").textContent;a.src=t,a.alt=r,s.textContent=r,C(l)})),i}function N(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function B(e){e.classList.add("popup-btn_disabled"),e.disabled=!0}const O=document.querySelector("#submit-add"),j=document.querySelector("#submit-edit");function J(e){var t;e.preventDefault(),N(!0,q),(t=b.value,fetch(`${P.url}/users/me/avatar`,{method:"PATCH",headers:P.headers,body:JSON.stringify({avatar:t})}).then(T)).then((()=>{E.src=b.value,$(y),B(q),e.target.reset()})).catch((e=>{console.log(e)})).finally((()=>{N(!1,q)}))}var W;f.addEventListener("click",(()=>{C(y)})),S.addEventListener("click",(()=>{$(y)})),L.addEventListener("submit",J),i.addEventListener("submit",(function(e){var a,l;e.preventDefault(),N(!0,j),(a=n.value,l=c.value,fetch(`${P.url}/users/me`,{method:"PATCH",headers:P.headers,body:JSON.stringify({name:a,about:l})}).then(T)).then((()=>{r.textContent=`${n.value}`,o.textContent=`${c.value}`,e.target.reset(),$(t)})).catch((e=>{console.log(e)})).finally((()=>{N(!1,j)}))})),h.addEventListener("click",(()=>{$(imagePopup)})),_.addEventListener("click",(()=>{C(m)})),v.addEventListener("click",(()=>{$(m)})),d.addEventListener("submit",(function(e){var t,r;e.preventDefault(),N(!0,O),Promise.all([(t=u.value,r=p.value,fetch(`${P.url}/cards`,{method:"POST",headers:P.headers,body:JSON.stringify({name:t,link:r})}).then(T)),A()]).then((([e,t])=>{const r=D(e.name,e.link,e.likes,e.owner._id,e._id,t._id);s.prepend(r)})).then((()=>{e.target.reset(),B(O),$(m)})).catch((e=>{console.log(e)})).finally((()=>{N(!1,O)}))})),L.addEventListener("submit",J),a.addEventListener("click",(()=>{$(t)})),v.addEventListener("click",(()=>{$(m)})),h.addEventListener("click",(()=>{$(l)})),e.addEventListener("click",(()=>C(t))),W={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup-btn",inactiveButtonClass:"popup-btn_disabled",inputErrorClass:"popup__form-input_error",errorWrapperSelector:".popup__error-message"},Array.from(document.querySelectorAll(W.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);k(r,o,t),r.forEach((e=>{e.addEventListener("input",(function(){((e,t,r)=>{t.validity.valid?((e,t,r)=>{const o=t.parentNode.querySelector(r.errorWrapperSelector);t.classList.remove(r.inputElementError),o.classList.remove(r.errorElementClass),o.textContent=""})(0,t,r):((e,t,r,o)=>{const n=t.parentNode.querySelector(o.errorWrapperSelector);t.classList.add(o.inputElementError),n.classList.add(o.errorElementClass),n.textContent=r})(0,t,t.validationMessage,r)})(0,e,t),k(r,o,t)}))}))})(e,W)})),Promise.all([A(),fetch(`${P.url}/cards`,{headers:P.headers}).then(T)]).then((([e,t])=>{r.textContent=e.name,o.textContent=e.about,E.src=e.avatar,t.forEach((t=>{const r=D(t.name,t.link,t.likes,t.owner._id,t._id,e._id);s.append(r)}))})).catch((e=>{console.log(e)}))})();